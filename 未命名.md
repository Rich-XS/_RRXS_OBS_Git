

# refresh.py (Playwright - V12.0 最终版 - 包含登录逻辑)
import time
from playwright.sync_api import sync_playwright

# --- 您的配置信息 ---
LOGIN_URL = "https://anyrouter.top/login" 
CONSOLE_URL = "https://anyrouter.top/console" 

# 🚨 替换为您真实有效的 AnyRouter 登录凭证！ 🚨
USER_CREDENTIAL = "您的邮箱或用户名"  
PASS_CREDENTIAL = "您的密码"         

# --- 关键定位器（经测试和分析确认）---
USER_SELECTOR = 'input[name="username"]'
PASS_SELECTOR = 'input[name="password"]'
LOGIN_BUTTON_SELECTOR = 'button:has-text("使用邮箱或用户名登录")' 
REFRESH_ICON_SELECTOR = 'span.semi-icon-refresh' 


def refresh_quota():
    try:
        with sync_playwright() as p:
            browser = p.chromium.launch(headless=True, args=['--no-sandbox', '--disable-setuid-sandbox'])
            page = browser.new_page()

            # --- 1. 执行登录 ---
            print(f"访问登录页面: {LOGIN_URL}")
            page.goto(LOGIN_URL, wait_until='domcontentloaded')

            print("尝试点击'使用邮箱或用户名登录'按钮...")
            page.click(LOGIN_BUTTON_SELECTOR)

            print("输入凭证...")
            page.fill(USER_SELECTOR, USER_CREDENTIAL)
            page.fill(PASS_SELECTOR, PASS_CREDENTIAL)

            print("点击登录...")
            page.click('button[type="submit"]') 

            print("登录中，等待页面跳转到控制台...")
            page.wait_for_url(CONSOLE_URL, timeout=30000)

            # --- 2. 执行刷新操作 ---
            print(f"已进入控制台，尝试点击刷新按钮: {REFRESH_ICON_SELECTOR}")
            page.wait_for_selector(REFRESH_ICON_SELECTOR, timeout=15000)
            page.click(REFRESH_ICON_SELECTOR) 

            print(">>> 额度刷新操作已执行！等待 5 秒确认赠送...")
            time.sleep(5)

            browser.close()
            print("刷新任务完成。")

    except Exception as e:
        print(f"任务执行失败或按钮未找到: {e}")

if __name__ == '__main__':
    refresh_quota()